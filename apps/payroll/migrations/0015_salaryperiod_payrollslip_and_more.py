# Generated by Django 5.2.6 on 2025-12-25 08:12

import django.db.models.deletion
from decimal import Decimal
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('hrm', '0024_alter_attendancedailyreport_options_and_more'),
        ('payroll', '0014_remove_penaltyticket_pen_ticket_pay_status_idx_and_more'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='SalaryPeriod',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('code', models.CharField(help_text='Unique code in format SP-YYYYMM', max_length=50, unique=True, verbose_name='Code')),
                ('month', models.DateField(db_index=True, help_text='First day of the salary month', unique=True, verbose_name='Month')),
                ('salary_config_snapshot', models.JSONField(help_text='Snapshot of salary configuration for this period', verbose_name='Salary Config Snapshot')),
                ('status', models.CharField(choices=[('ONGOING', 'Ongoing'), ('COMPLETED', 'Completed')], db_index=True, default='ONGOING', help_text='Current status of the period', max_length=20, verbose_name='Status')),
                ('standard_working_days', models.DecimalField(decimal_places=2, help_text='Total working days in the month', max_digits=5, verbose_name='Standard Working Days')),
                ('total_employees', models.PositiveIntegerField(default=0, help_text='Count of employees with payroll slips in this period', verbose_name='Total Employees')),
                ('completed_at', models.DateTimeField(blank=True, help_text='Timestamp when period was completed', null=True, verbose_name='Completed At')),
                ('completed_by', models.ForeignKey(blank=True, help_text='User who completed the period', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='completed_salary_periods', to=settings.AUTH_USER_MODEL, verbose_name='Completed By')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_salary_periods', to=settings.AUTH_USER_MODEL, verbose_name='Created By')),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='updated_salary_periods', to=settings.AUTH_USER_MODEL, verbose_name='Updated By')),
            ],
            options={
                'verbose_name': 'Salary Period',
                'verbose_name_plural': 'Salary Periods',
                'db_table': 'payroll_salary_period',
                'ordering': ['-month'],
            },
        ),
        migrations.CreateModel(
            name='PayrollSlip',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('code', models.CharField(max_length=50, unique=True, verbose_name='Code')),
                ('employee_code', models.CharField(max_length=50, verbose_name='Employee Code')),
                ('employee_name', models.CharField(max_length=250, verbose_name='Employee Name')),
                ('department_name', models.CharField(max_length=250, verbose_name='Department Name')),
                ('position_name', models.CharField(max_length=250, verbose_name='Position Name')),
                ('employment_status', models.CharField(max_length=20, verbose_name='Employment Status')),
                ('has_unpaid_penalty', models.BooleanField(default=False, help_text='Flag if employee has unpaid penalty tickets', verbose_name='Has Unpaid Penalty')),
                ('unpaid_penalty_count', models.IntegerField(default=0, help_text='Count of unpaid penalty tickets', verbose_name='Unpaid Penalty Count')),
                ('contract_id', models.UUIDField(blank=True, null=True, verbose_name='Contract ID')),
                ('base_salary', models.DecimalField(decimal_places=0, default=0, max_digits=20, verbose_name='Base Salary')),
                ('kpi_salary', models.DecimalField(decimal_places=0, default=0, max_digits=20, verbose_name='KPI Salary')),
                ('lunch_allowance', models.DecimalField(decimal_places=0, default=0, max_digits=20, verbose_name='Lunch Allowance')),
                ('phone_allowance', models.DecimalField(decimal_places=0, default=0, max_digits=20, verbose_name='Phone Allowance')),
                ('other_allowance', models.DecimalField(decimal_places=0, default=0, max_digits=20, verbose_name='Other Allowance')),
                ('kpi_grade', models.CharField(default='C', max_length=10, verbose_name='KPI Grade')),
                ('kpi_percentage', models.DecimalField(decimal_places=4, default=Decimal('0.0000'), max_digits=5, verbose_name='KPI Percentage')),
                ('kpi_bonus', models.DecimalField(decimal_places=0, default=0, max_digits=20, verbose_name='KPI Bonus')),
                ('sales_revenue', models.BigIntegerField(default=0, verbose_name='Sales Revenue')),
                ('sales_transaction_count', models.IntegerField(default=0, verbose_name='Sales Transaction Count')),
                ('business_grade', models.CharField(default='M0', max_length=10, verbose_name='Business Grade')),
                ('business_progressive_salary', models.DecimalField(decimal_places=0, default=0, max_digits=20, verbose_name='Business Progressive Salary')),
                ('standard_working_days', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=5, verbose_name='Standard Working Days')),
                ('total_working_days', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=5, verbose_name='Total Working Days')),
                ('official_working_days', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=5, verbose_name='Official Working Days')),
                ('probation_working_days', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=5, verbose_name='Probation Working Days')),
                ('saturday_inweek_overtime_hours', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=8, verbose_name='Saturday & Weekday Overtime Hours')),
                ('sunday_overtime_hours', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=8, verbose_name='Sunday Overtime Hours')),
                ('holiday_overtime_hours', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=8, verbose_name='Holiday Overtime Hours')),
                ('total_overtime_hours', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=8, verbose_name='Total Overtime Hours')),
                ('hourly_rate', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=20, verbose_name='Hourly Rate')),
                ('overtime_pay', models.DecimalField(decimal_places=0, default=0, max_digits=20, verbose_name='Overtime Pay')),
                ('taxable_travel_expense', models.DecimalField(decimal_places=0, default=0, max_digits=20, verbose_name='Taxable Travel Expense')),
                ('non_taxable_travel_expense', models.DecimalField(decimal_places=0, default=0, max_digits=20, verbose_name='Non-Taxable Travel Expense')),
                ('total_travel_expense', models.DecimalField(decimal_places=0, default=0, max_digits=20, verbose_name='Total Travel Expense')),
                ('gross_income', models.DecimalField(decimal_places=0, default=0, max_digits=20, verbose_name='Gross Income')),
                ('taxable_income_base', models.DecimalField(decimal_places=0, default=0, max_digits=20, verbose_name='Taxable Income Base')),
                ('social_insurance_base', models.DecimalField(decimal_places=0, default=0, max_digits=20, verbose_name='Social Insurance Base')),
                ('employee_social_insurance', models.DecimalField(decimal_places=0, default=0, max_digits=20, verbose_name='Employee Social Insurance')),
                ('employee_health_insurance', models.DecimalField(decimal_places=0, default=0, max_digits=20, verbose_name='Employee Health Insurance')),
                ('employee_unemployment_insurance', models.DecimalField(decimal_places=0, default=0, max_digits=20, verbose_name='Employee Unemployment Insurance')),
                ('employee_union_fee', models.DecimalField(decimal_places=0, default=0, max_digits=20, verbose_name='Employee Union Fee')),
                ('employer_social_insurance', models.DecimalField(decimal_places=0, default=0, max_digits=20, verbose_name='Employer Social Insurance')),
                ('employer_health_insurance', models.DecimalField(decimal_places=0, default=0, max_digits=20, verbose_name='Employer Health Insurance')),
                ('employer_unemployment_insurance', models.DecimalField(decimal_places=0, default=0, max_digits=20, verbose_name='Employer Unemployment Insurance')),
                ('employer_union_fee', models.DecimalField(decimal_places=0, default=0, max_digits=20, verbose_name='Employer Union Fee')),
                ('employer_accident_insurance', models.DecimalField(decimal_places=0, default=0, max_digits=20, verbose_name='Employer Accident Insurance')),
                ('personal_deduction', models.DecimalField(decimal_places=0, default=0, max_digits=20, verbose_name='Personal Deduction')),
                ('dependent_count', models.IntegerField(default=0, verbose_name='Dependent Count')),
                ('dependent_deduction', models.DecimalField(decimal_places=0, default=0, max_digits=20, verbose_name='Dependent Deduction')),
                ('taxable_income', models.DecimalField(decimal_places=0, default=0, max_digits=20, verbose_name='Taxable Income')),
                ('personal_income_tax', models.DecimalField(decimal_places=0, default=0, max_digits=20, verbose_name='Personal Income Tax')),
                ('back_pay_amount', models.DecimalField(decimal_places=0, default=0, max_digits=20, verbose_name='Back Pay Amount')),
                ('recovery_amount', models.DecimalField(decimal_places=0, default=0, max_digits=20, verbose_name='Recovery Amount')),
                ('net_salary', models.DecimalField(decimal_places=0, default=0, max_digits=20, verbose_name='Net Salary')),
                ('status', models.CharField(choices=[('PENDING', 'Pending'), ('READY', 'Ready'), ('HOLD', 'Hold'), ('DELIVERED', 'Delivered')], db_index=True, default='PENDING', max_length=20, verbose_name='Status')),
                ('status_note', models.TextField(blank=True, help_text='Reason for PENDING or HOLD status', verbose_name='Status Note')),
                ('need_resend_email', models.BooleanField(db_index=True, default=False, help_text='Flag if email needs to be resent', verbose_name='Need Resend Email')),
                ('email_sent_at', models.DateTimeField(blank=True, null=True, verbose_name='Email Sent At')),
                ('delivered_at', models.DateTimeField(blank=True, null=True, verbose_name='Delivered At')),
                ('calculation_log', models.JSONField(default=dict, help_text='Detailed breakdown of calculation', verbose_name='Calculation Log')),
                ('calculated_at', models.DateTimeField(blank=True, db_index=True, null=True, verbose_name='Calculated At')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_payroll_slips', to=settings.AUTH_USER_MODEL, verbose_name='Created By')),
                ('delivered_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='delivered_payroll_slips', to=settings.AUTH_USER_MODEL, verbose_name='Delivered By')),
                ('employee', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='payroll_slips', to='hrm.employee', verbose_name='Employee')),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='updated_payroll_slips', to=settings.AUTH_USER_MODEL, verbose_name='Updated By')),
                ('salary_period', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='payroll_slips', to='payroll.salaryperiod', verbose_name='Salary Period')),
            ],
            options={
                'verbose_name': 'Payroll Slip',
                'verbose_name_plural': 'Payroll Slips',
                'db_table': 'payroll_payroll_slip',
                'ordering': ['-calculated_at'],
            },
        ),
        migrations.AddIndex(
            model_name='salaryperiod',
            index=models.Index(fields=['month'], name='salary_period_month_idx'),
        ),
        migrations.AddIndex(
            model_name='salaryperiod',
            index=models.Index(fields=['status'], name='salary_period_status_idx'),
        ),
        migrations.AddIndex(
            model_name='salaryperiod',
            index=models.Index(fields=['-created_at'], name='salary_period_created_idx'),
        ),
        migrations.AddIndex(
            model_name='payrollslip',
            index=models.Index(fields=['salary_period', 'status'], name='payroll_slip_period_status_idx'),
        ),
        migrations.AddIndex(
            model_name='payrollslip',
            index=models.Index(fields=['employee'], name='payroll_slip_employee_idx'),
        ),
        migrations.AddIndex(
            model_name='payrollslip',
            index=models.Index(fields=['status'], name='payroll_slip_status_idx'),
        ),
        migrations.AddIndex(
            model_name='payrollslip',
            index=models.Index(fields=['need_resend_email'], name='payroll_slip_resend_idx'),
        ),
        migrations.AddIndex(
            model_name='payrollslip',
            index=models.Index(fields=['-calculated_at'], name='payroll_slip_calculated_idx'),
        ),
        migrations.AddConstraint(
            model_name='payrollslip',
            constraint=models.UniqueConstraint(fields=('salary_period', 'employee'), name='unique_salary_period_employee'),
        ),
    ]
